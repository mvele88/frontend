<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TrueBotAI Ultra Yield</title>
<style>
body { font-family: 'Roboto', sans-serif; background: #0a0f1a; color: #cbd5e1; margin:0; }
header, nav, main, footer { padding:1rem; }
header { background:#111827; color:#f59e0b; text-align:center; }
nav { display:flex; justify-content:center; gap:1rem; margin-top:1rem; }
nav button { padding:0.5rem 1rem; border:none; border-radius:8px; cursor:pointer; }
nav button.active { background:#f59e0b; color:#0a0f1a; }
.section { display:none; margin-top:1rem; background:#1e293b; padding:1rem; border-radius:12px; }
.section.active { display:block; }
button.connect-wallet, .activate-btn, #withdrawalBtn { background:#f59e0b; border:none; padding:0.5rem 1rem; border-radius:20px; cursor:pointer; color:#0a0f1a; font-weight:bold; margin-top:1rem; }
.modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; }
.modal-content { background:#1e293b; padding:2rem; border-radius:12px; position:relative; color:#fbbf24; }
.close-button { position:absolute; top:10px; right:20px; cursor:pointer; font-size:24px; }
</style>
</head>
<body>

<header>
<h1>TrueBotAI Ultra Yield</h1>
<div class="fee-notice">Performance Fee: <strong>20% of net profits</strong></div>
<button class="connect-wallet">Connect Wallet</button>
</header>

<nav>
<button class="active" data-section="trading">Ultra Trading Bots</button>
<button data-section="sniping">Extreme Sniping</button>
<button data-section="staking">Yield Farming</button>
<button data-section="mining">Quantum Mining</button>
<button data-section="portfolio">Portfolio Overview</button>
</nav>

<main>
<section id="trading" class="section active">
<h2>Ultra Trading Bots</h2>
<div class="card" data-cid="QmTWm6xa4yXTP8TUgWstqoKn5aGhfzoa5ejntuUyhFbHVn">
<h3>Leverage Trading Bot</h3>
<button class="activate-btn">Activate</button>
</div>
</section>

<section id="portfolio" class="section">
<h2>Portfolio Overview</h2>
<div>
<p>Current Balance: <span id="currentBalance">200.00 SOL</span></p>
<p>Total Profits: <span id="totalProfits">50.00 SOL</span></p>
<button id="withdrawalBtn">Initiate Withdrawal</button>
</div>
</section>
</main>

<footer>
Performance Fee: <strong>20% of net profits</strong> â€” No upfront fees.
</footer>

<div id="paymentModal" class="modal">
<div class="modal-content">
<span class="close-button">&times;</span>
<div id="modalBody"></div>
</div>
</div>

<script src="https://unpkg.com/@solana/web3.js@1.78.5/lib/index.iife.js"></script>
<script>
const paymentModal = document.getElementById('paymentModal');
const modalBody = document.getElementById('modalBody');
const closeButton = document.querySelector('.close-button');
closeButton.onclick = () => paymentModal.style.display='none';
window.onclick = (e)=>{if(e.target===paymentModal) paymentModal.style.display='none';};

function showModal(html){ modalBody.innerHTML=html; paymentModal.style.display='flex'; }

// --- Navigation ---
document.querySelectorAll('nav button').forEach(btn=>{
btn.onclick=()=>{
document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
btn.classList.add('active');
document.querySelectorAll('.section').forEach(sec=>{
sec.classList.remove('active');
if(sec.id===btn.dataset.section) sec.classList.add('active');
});
};
});

// --- Wallet connection ---
let userWallet=null;
const connectButton=document.querySelector('.connect-wallet');
async function connectWallet(){
try{
if(window.solana && window.solana.isPhantom){
const resp=await window.solana.connect();
userWallet=resp.publicKey;
connectButton.textContent='Wallet Connected';
}else showModal('<p>Phantom wallet not found</p>');
}catch(err){showModal('<p>Failed to connect wallet</p>');}
}
window.addEventListener('load', connectWallet);
connectButton.addEventListener('click', connectWallet);

// --- Activate IPFS content ---
document.querySelectorAll('.activate-btn').forEach(btn=>{
btn.onclick=async (e)=>{
const card=e.target.closest('.card');
const cid=card.dataset.cid;
if(!cid){showModal('<p>No CID found</p>'); return;}
showModal('<p>Fetching content from IPFS...</p>');
try{
const resp=await fetch(`/api/ipfs/${cid}`);
if(!resp.ok) throw new Error('Network response was not ok');
const html=await resp.text();
card.innerHTML=html;
paymentModal.style.display='none';
}catch(err){showModal('<p>Error loading content: '+err.message+'</p>');}
};
});

// --- Withdrawal ---
document.getElementById('withdrawalBtn').onclick=async ()=>{
if(!userWallet){showModal('<p>Connect wallet first</p>'); return;}
const userProfit=parseFloat(document.getElementById('totalProfits').textContent);
if(isNaN(userProfit)||userProfit<=0){showModal('<p>No profits to withdraw</p>'); return;}
showModal('<p>Processing withdrawal...</p>');
try{
const resp=await fetch('/api/withdraw',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({userProfit})});
if(!resp.ok) throw new Error('Failed to get withdrawal details');
const data=await resp.json();
showModal('<p>Send '+data.feeAmount+' SOL to '+data.address+'</p>');
}catch(err){showModal('<p>Withdrawal error: '+err.message+'</p>');}
};
</script>

</body>
</html>
