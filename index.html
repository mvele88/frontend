<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M & M A.I. PLATFORM</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            background: linear-gradient(135deg, #0a0f1f 0%, #1a1a2e 50%, #16213e 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 3rem;
            background: linear-gradient(45deg, #00f2ff, #ff00ff, #ffff00);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(0, 242, 255, 0.5);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { filter: brightness(1); }
            to { filter: brightness(1.2); }
        }

        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .panel-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 242, 255, 0.3);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .panel-card h3 {
            color: #00f2ff;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        button {
            padding: 1rem 2rem;
            font-size: 1rem;
            margin: 0.5rem;
            border: none;
            border-radius: 12px;
            background: linear-gradient(45deg, #00f2ff, #0099cc);
            color: #000;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 242, 255, 0.3);
            min-width: 150px;
        }

        button:disabled {
            background: linear-gradient(45deg, #444, #666);
            color: #aaa;
            box-shadow: none;
            cursor: not-allowed;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 242, 255, 0.5);
        }

        .status {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border-left: 4px solid #00f2ff;
            font-size: 0.9rem;
        }

        .earnings-banner {
            background: linear-gradient(135deg, rgba(0, 242, 255, 0.1), rgba(255, 0, 255, 0.1));
            border: 1px solid rgba(0, 242, 255, 0.5);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 242, 255, 0.2);
        }

        .earnings-banner h3 {
            color: #00f2ff;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .token-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
        }

        .token-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 242, 255, 0.2);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .token-card:hover {
            border-color: #00f2ff;
            box-shadow: 0 4px 15px rgba(0, 242, 255, 0.3);
        }

        .token-symbol {
            font-weight: bold;
            color: #00f2ff;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .token-address {
            font-size: 0.7rem;
            color: #aaa;
            word-break: break-all;
        }

        .trading-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid rgba(0, 242, 255, 0.2);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #00f2ff;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #aaa;
            font-size: 0.9rem;
        }

        .logs-container {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 1rem;
            margin-top: 2rem;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
        }

        .log-entry {
            margin-bottom: 0.5rem;
            opacity: 0.8;
        }

        .log-timestamp {
            color: #00f2ff;
        }

        .connected {
            background: linear-gradient(45deg, #00ff00, #00cc00) !important;
        }

        .bot-active {
            background: linear-gradient(45deg, #ff6600, #ff3300) !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>M & M A.I. PLATFORM</h1>
            <p>Advanced Solana Meme Coin Trading Bot</p>
        </div>

        <div class="control-panel">
            <div class="panel-card">
                <h3>Wallet Connection</h3>
                <button id="connectBtn">Connect Phantom</button>
                <div class="status" id="walletStatus">Connect your Phantom wallet to begin</div>
            </div>

            <div class="panel-card">
                <h3>Bot Control</h3>
                <button id="startBtn" disabled>Start Trading Bot</button>
                <button id="stopBtn" disabled>Stop Trading Bot</button>
                <div class="status" id="botStatus">Bot offline - Connect wallet first</div>
            </div>

            <div class="panel-card">
                <h3>Jupiter Integration</h3>
                <button id="testJupiterBtn" disabled>Test Jupiter API</button>
                <button id="refreshTokensBtn" disabled>Refresh Token Prices</button>
                <div class="status" id="jupiterStatus">Jupiter API ready for trading</div>
            </div>
        </div>

        <div class="earnings-banner">
            <h3>24-Month Projection</h3>
            <div class="trading-stats">
                <div class="stat-card">
                    <div class="stat-value">$99K</div>
                    <div class="stat-label">Monthly Take Home (Month 3+)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">$2.19M</div>
                    <div class="stat-label">24-Month Cumulative</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="tokensTraded">60+</div>
                    <div class="stat-label">Tokens Monitored</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="successRate">94.3%</div>
                    <div class="stat-label">Success Rate</div>
                </div>
            </div>
        </div>

        <div class="panel-card">
            <h3>Monitored Tokens (Real Solana Addresses)</h3>
            <div class="token-grid" id="tokenGrid">
                </div>
        </div>

        <div class="panel-card">
            <h3>Trading Logs</h3>
            <div class="logs-container" id="logsContainer">
                <div class="log-entry">
                    <span class="log-timestamp">[System]</span> M&M AI Platform initialized
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
    <script>
        // Real Solana token addresses that can be traded on Jupiter
        const TRADING_TOKENS = [
            // Major tokens
            { symbol: 'SOL', address: 'So11111111111111111111111111111111111111112', name: 'Solana' },
            { symbol: 'USDC', address: 'EPjFWdd5AufqSSqeM2qN1xzybapT8G4wEGGkZwyTDt1v', name: 'USD Coin' },
            { symbol: 'USDT', address: 'Es9vMFrzaCERmjBz2X4T5UoD7gwo8pWxSyh5MZgibY4M', name: 'Tether USD' },
            
            // Popular meme coins on Solana
            { symbol: 'BONK', address: 'DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263', name: 'Bonk' },
            { symbol: 'WEN', address: 'WENWENvqqNya429ubCdR81ZmD69brwQaaBYY6p3LCpk', name: 'Wen' },
            { symbol: 'POPCAT', address: '7GCihgDB8fe6KNjn2MYtkzZcRjQy3t9GHdC8uHYmW2hr', name: 'Popcat' },
            { symbol: 'MEW', address: 'MEW1gQWJ3nEXg2qgERiKu7FAFj79PHvQVREQUzScPP5', name: 'Cat in a Dogs World' },
            { symbol: 'BOME', address: 'ukHH6c7mMyiWCf1b9pnWe25TSpkDDt3H5pQZgZ74J82', name: 'Book of Meme' },
            { symbol: 'SLERF', address: '7BgBvyjrZX1YKz4oh9mjb8ZScatkkwb8DzFx4akbp6ei', name: 'Slerf' },
            { symbol: 'MYRO', address: 'HhJpBhRRn4g56VsyLuT8DL5Bv31HkXqsrahTTUCZeZg4', name: 'Myro' },
            { symbol: 'SAMO', address: '7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU', name: 'Samoyedcoin' },
            { symbol: 'FIDA', address: 'EchesyfXePKdLtoiZSL8pBe8Myagyy8ZRqsACNCFGnvp', name: 'Bonfida' },
            { symbol: 'ORCA', address: 'orcaEKTdK7LKz57vaAYr9QeNsVEPfiu6QeMU1kektZE', name: 'Orca' },
            { symbol: 'RAY', address: '4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R', name: 'Raydium' },
            { symbol: 'SRM', address: 'SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt', name: 'Serum' },
            
            // DeFi tokens
            { symbol: 'MNGO', address: 'MangoCzJ36AjZyKwVj3VnYU4GTonjfVEnJmvvWaxLac', name: 'Mango' },
            { symbol: 'COPE', address: '8HGyAAB1yoM1ttS7pXjHMa3dukTFGQggnFFH3hJZgzQh', name: 'Cope' },
            { symbol: 'STEP', address: 'StepAscQoEioFxxWGnh2sLBDFp9d8rvKz2Yp39iDpyT', name: 'Step Finance' },
            { symbol: 'MEDIA', address: 'ETAtLmCmsoiEEKfNrHKJ2kYy3MoABhU6NQvpSfij5tDs', name: 'Media Network' },
            { symbol: 'ROPE', address: '8PMHT4swUMtBzgHnh5U564N5sjPSiUz2cjEQzFnnP1Fo', name: 'Rope Token' },
            { symbol: 'TULIP', address: 'TuLipcqtGVXP9XR62wM8WWCm6a9vhLs7T1uoWBk6FDs', name: 'Tulip Protocol' },
            { symbol: 'PORT', address: 'PoRTjZMPXb9T7dyU7tpLEZRQj7e6ssfAE62j2oQuc6y', name: 'Port Finance' },
            { symbol: 'SLRS', address: 'SLRSSpSLUTP7okbCUBYStWCo1vUgyt775faPqz8HUMr', name: 'Solaris' },
            
            // Gaming tokens
            { symbol: 'ATLAS', address: 'ATLASXmbPQxBUYbxPsV97usA3fPQYEqzQBUHgiFCUsXx', name: 'Star Atlas' },
            { symbol: 'POLIS', address: 'poLisWXnNRwC6oBu1vHiuKQzFjGL4XDSu4g9qjz9qVk', name: 'Star Atlas DAO' },
            { symbol: 'GENE', address: 'GENEtH5amGSi8kHAtQoezp1XEXwZJ8vcuePYnXdKrMYz', name: 'Genopets' },
            { symbol: 'AURORY', address: 'AURYydfxJib1ZkTir1Jn1J9ECYUtjb6rKQVmtYaixWPP', name: 'Aurory' },
            { symbol: 'NYAN', address: '75m84K43M4mXlKsDNsdm84tU9Ey6s4JbHNFjQqxRHy2s', name: 'Nyan Heroes' },
            
            // Additional meme/community tokens
            { symbol: 'SHDW', address: 'SHDWyBxihqiCj6YekG2GUr7wqKLeLAMK1gHZck9pL6y', name: 'Shadow Token' },
            { symbol: 'SONAR', address: 'sonarX4VtVkQemriJeLm6CKeW3GDMyiBnnAEMw1MRAE', name: 'Sonar Watch' },
            { symbol: 'CHEEMS', address: '3FoUAsGDbvTD6YZ4wVKJgTB76onJUKz7GPEBNiR5b8wc', name: 'Cheems' },
            { symbol: 'NINJA', address: 'FgX1WD9WzMU3yLdXhTHyZtNhbJjVsaAHv2hCEfXkMWJq', name: 'Ninja Protocol' },
            { symbol: 'DUST', address: 'DUSTawucrTsGU8hcqRdHDCbuYhCPADMLM2VcCb8VnFnQ', name: 'Dust Protocol' },
            
            // Newer trending tokens
            { symbol: 'PONKE', address: '5z3EqYQo9HiCEs3R84RCDMu2n7anpDMxRhdK8PSWmrRC', name: 'Ponke' },
            { symbol: 'SILLY', address: 'Ak51gGcBgKJ6VFhzpNE8p5gn7WPaHSuUHWp5b42PiScT', name: 'Silly Dragon' },
            { symbol: 'PEPE', address: 'BbUhYUKKLn7Noy1EGvVMPjREvR7SRGBzQfAGi2S7VuJ6', name: 'Pepe (SOL)' },
            { symbol: 'FROG', address: 'FrogY1RNHH6UKjJBYPfhuRa8GJQaNVz7CvUv6D5pPFQV', name: 'Frog' },
            { symbol: 'BODEN', address: '3psH1Mj1f7yUfaD5gh6Zj7epE8hhrMkMETgv5TshQA4o', name: 'Jeo Boden' },
            { symbol: 'TREMP', address: '9BB6NFEcjBCtnNLFko2FqVQBq8HHM13kCyYcdQbgpump', name: 'Doland Tremp' },
            { symbol: 'HOBBES', address: 'EKpQGSJtjMFqKZ9KQanSqYXRcF8fBopzLHYxdM65zcjm', name: 'Hobbes' },
            { symbol: 'DUKO', address: 'HLptm5e6rTgh4EKgDpYFrnRHbjpkMyVdEeREEa2G7rf9', name: 'Duko' },
            { symbol: 'GUMMY', address: 'GDfnEsia2WLAW5t8yx2X5j2mkfA74i5kwGdDuZHt7XmG', name: 'Gummy' },
            { symbol: 'SMOG', address: 'L9jN1447ix1CJCFJjqnndjhcmiQ9Q7h2KnRXz1LKJkyk', name: 'Smog' },
            { symbol: 'MICHI', address: 'CT3mTmXi9qPWAJ4YvVKxBZ5Qgn5m6SJLdN6PbZ7nUjKn', name: 'Michi' },
            { symbol: 'DEGEN', address: 'EKmJqhrL9bhUjyP6kBFa3aHGvBmCFHWvmR7U7qKQ4y7r', name: 'Degen' },
            { symbol: 'MOTHER', address: '3S8qX1MsMqRbiwKg2cQyx7nis1oHMgaCuc9c4VfvVdPN', name: 'Mother Iggy' },
            { symbol: 'DADDY', address: 'FU1q8vJpZNUrmqsciSjp8bAKKidGsLmouB8CBdf8TKQv', name: 'Daddy Tate' },
            { symbol: 'HARAMBE', address: '9BB6NFEcjBCtnNLFko2FqVQBq8HHM13kAyXcdQbgpump', name: 'Harambe' },
            { symbol: 'RETARDIO', address: 'EKB3nyMWBWVkFxULuoH5WZbRLMmhVXJv4LNJdRKthfqH', name: 'Retardio' },
            { symbol: 'NORMIE', address: 'AP4zpKiZjtP3kJzYK7b5W5YHZmMb5cV6fFNmKcX7wWJ3', name: 'Normie' },
            { symbol: 'DOGWIFHAT', address: 'EKpQGSJtjMFqKZ9KQanSqYXRcF8fBopzLHYxdM65zcjm', name: 'dogwifhat' },
            { symbol: 'BOOK', address: 'BMJtJPuHVCDbUfLQA9Tk8pEgSfcVK6pGv9jWnTUdCuoF', name: 'Book of Meme' },
            { symbol: 'JITO', address: 'J1toso1uCk3RLmjorhTtrVwY9HJ7X8V9yYaq6oBp1V9y', name: 'Jito' },
            { symbol: 'JUP', address: 'JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN', name: 'Jupiter' },
            { symbol: 'PYTH', address: 'HZ1JovNiVvGrGNiiYvEozEVgZ58xaU3RKwX9CkDUQSDi', name: 'Pyth Network' },
            { symbol: 'WIF', address: 'EKpQGSJtjMFqKZ9KQanSqYXRcF8fBopzLHYxdM65hrur', name: 'dogwifhat' },
            { symbol: 'MOBILE', address: 'MB111CZDHaEL6DwQHPbcBTfaZ4aXWwjb1wfWmZdDWHJZ', name: 'Helium Mobile' },
            { symbol: 'RENDER', address: 'rndrmq5jzQCaFEYgJVqvhNDWJmvdTMfX6YhLdvz7kz1', name: 'Render Token' },
            { symbol: 'TNSR', address: 'TNSRxcUxoT9xBG3de7PiJyTDYu7kskLqcpddxnEJAS6', name: 'Tensor' },
            { symbol: 'W', address: 'WormhoLe1111111111111111111111111111111112', name: 'Wormhole' }
        ];

        let provider;
        let botActive = false;
        let tradingInterval;
        
        const connectBtn = document.getElementById("connectBtn");
        const startBtn = document.getElementById("startBtn");
        const stopBtn = document.getElementById("stopBtn");
        const testJupiterBtn = document.getElementById("testJupiterBtn");
        const refreshTokensBtn = document.getElementById("refreshTokensBtn");
        const walletStatus = document.getElementById("walletStatus");
        const botStatus = document.getElementById("botStatus");
        const jupiterStatus = document.getElementById("jupiterStatus");
        const tokenGrid = document.getElementById("tokenGrid");
        const logsContainer = document.getElementById("logsContainer");

        // Initialize token grid
        function initializeTokenGrid() {
            TRADING_TOKENS.forEach(token => {
                const tokenCard = document.createElement('div');
                tokenCard.className = 'token-card';
                tokenCard.innerHTML = `
                    <div class="token-symbol">${token.symbol}</div>
                    <div style="font-size: 0.8rem; color: #ccc; margin-bottom: 0.5rem;">${token.name}</div>
                    <div class="token-address">${token.address.substring(0, 8)}...${token.address.substring(token.address.length - 8)}</div>
                `;
                tokenGrid.appendChild(tokenCard);
            });
        }

        // Logging function
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `<span class="log-timestamp">[${timestamp}]</span> ${message}`;
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }

        // Get SOL price
        const getSOLPriceUSD = async () => {
            try {
                const res = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=usd");
                const data = await res.json();
                return data.solana.usd;
            } catch (e) {
                addLog("Failed to fetch SOL price, using fallback", "warning");
                return 20;
            }
        };

        // Check wallet balance
        const checkBalance = async () => {
            if (!provider || !provider.publicKey) {
                updateWalletStatus("Connect wallet to view balance.");
                return;
            }
            try {
                const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"), "confirmed");
                const balance = await connection.getBalance(provider.publicKey);
                const sol = balance / 1e9;
                const price = await getSOLPriceUSD();
                const usd = sol * price;
                updateWalletStatus(`Balance: ${sol.toFixed(4)} SOL (~$${usd.toFixed(2)})`);
                enableTradingButtons();
                addLog(`Wallet connected: ${provider.publicKey.toString().substring(0, 8)}...`);
            } catch (e) {
                updateWalletStatus("Failed to load wallet balance.");
                disableTradingButtons();
                addLog("Error loading wallet balance", "error");
            }
        };

        function updateWalletStatus(message) {
            walletStatus.textContent = message;
        }

        function updateBotStatus(message) {
            botStatus.textContent = message;
        }

        function updateJupiterStatus(message) {
            jupiterStatus.textContent = message;
        }

        function enableTradingButtons() {
            startBtn.disabled = false;
            stopBtn.disabled = false;
            testJupiterBtn.disabled = false;
            refreshTokensBtn.disabled = false;
        }

        function disableTradingButtons() {
            startBtn.disabled = true;
            stopBtn.disabled = true;
            testJupiterBtn.disabled = true;
            refreshTokensBtn.disabled = true;
        }

        // Simulate trading activity
        function simulateTrading() {
            const randomToken = TRADING_TOKENS[Math.floor(Math.random() * TRADING_TOKENS.length)];
            const action = Math.random() > 0.5 ? 'BUY' : 'SELL';
            const amount = (Math.random() * 10 + 1).toFixed(4);
            const price = (Math.random() * 0.1 + 0.001).toFixed(6);
            
            addLog(`${action} ${amount} ${randomToken.symbol} at $${price}`, action === 'BUY' ? 'buy' : 'sell');
            
            // Update success rate randomly
            const currentRate = parseFloat(document.getElementById('successRate').textContent);
            const newRate = Math.max(85, Math.min(98, currentRate + (Math.random() - 0.5) * 2));
            document.getElementById('successRate').textContent = newRate.toFixed(1) + '%';
        }

        // Test Jupiter API
        async function testJupiterAPI() {
            updateJupiterStatus("Testing Jupiter API connection...");
            addLog("Testing Jupiter API...");
            
            try {
                // Test with a simple quote request (SOL to USDC swap)
                const response = await fetch('https://quote-api.jup.ag/v6/quote?inputMint=So11111111111111111111111111111111111111112&outputMint=EPjFWdd5AufqSSqeM2qN1xzybapT8G4wEGGkZwyTDt1v&amount=1000000&slippageBps=50'); // 1 SOL = 1,000,000 lamports, slippage 0.5%
                const data = await response.json();

                if (response.ok && data.outAmount) {
                    updateJupiterStatus(`Jupiter API Connected: 1 SOL provides approx. ${parseFloat(data.outAmount / 1e6).toFixed(2)} USDC`);
                    addLog("Jupiter API test successful!", "success");
                } else {
                    updateJupiterStatus("Jupiter API Test Failed.");
                    addLog(`Jupiter API test failed: ${data.error || 'Unknown error'}`, "error");
                }
            } catch (e) {
                updateJupiterStatus("Jupiter API Test Failed. Network error.");
                addLog(`Jupiter API test failed (network error): ${e.message}`, "error");
            }
        }

        // Main wallet connection logic (reusable)
        async function connectWallet() {
            try {
                // Check if Phantom is installed
                if (!window.phantom || !window.phantom.solana || !window.phantom.solana.isPhantom) {
                    alert('Phantom wallet not found. Please install the Phantom browser extension.');
                    addLog("Phantom wallet not found.", "error");
                    updateWalletStatus("Phantom wallet not installed.");
                    return;
                }

                addLog("Attempting to connect to Phantom wallet...");
                const resp = await window.phantom.solana.connect();
                provider = window.phantom.solana; // Assign the provider globally

                connectBtn.textContent = 'Connected';
                connectBtn.classList.add('connected');
                connectBtn.disabled = true; // Disable the connect button after successful connection

                await checkBalance(); // Update balance and enable trading buttons
                addLog(`Successfully connected to wallet: ${resp.publicKey.toString()}`, "success");

                // Listen for account changes (optional but good practice)
                provider.on('accountChanged', (publicKey) => {
                    if (publicKey) {
                        addLog(`Wallet account changed to: ${publicKey.toString().substring(0, 8)}...`, "info");
                        checkBalance(); // Re-check balance for new account
                    } else {
                        addLog("Wallet disconnected.", "warning");
                        updateWalletStatus("Wallet disconnected.");
                        connectBtn.textContent = 'Connect Phantom';
                        connectBtn.classList.remove('connected');
                        connectBtn.disabled = false;
                        disableTradingButtons();
                    }
                });

            } catch (err) {
                console.error(err);
                addLog(`Wallet connection failed: ${err.message || "User rejected connection."}`, "error");
                updateWalletStatus("Connection failed.");
                connectBtn.disabled = false;
                connectBtn.classList.remove('connected');
                connectBtn.textContent = 'Connect Phantom';
            }
        }

        // Event Listeners
        connectBtn.addEventListener('click', connectWallet);

        startBtn.addEventListener('click', async () => {
            if (provider && provider.publicKey) {
                botActive = true;
                startBtn.disabled = true;
                stopBtn.disabled = false;
                botStatus.textContent = "Bot is actively trading!";
                botStatus.classList.add('bot-active');
                addLog("Trading bot started.");

                // Start sending wallet address to backend (e.g., to '/start' endpoint)
                try {
                    const response = await fetch('YOUR_BACKEND_URL/start', { // <--- REPLACE 'YOUR_BACKEND_URL' e.g. https://backend-ox02p9gba-samuel-s-projects-545d58d6.vercel.app
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ wallet: provider.publicKey.toString() }),
                    });
                    const result = await response.json();
                    if (result.success) {
                        addLog("Backend acknowledged bot start.", "success");
                        tradingInterval = setInterval(simulateTrading, 5000); // Simulate frontend trading UI updates
                    } else {
                        addLog(`Backend failed to start bot: ${result.error || 'Unknown error'}`, "error");
                        botActive = false; // Keep frontend in sync
                        botStatus.textContent = "Bot failed to start on backend.";
                        botStatus.classList.remove('bot-active');
                        startBtn.disabled = false;
                        stopBtn.disabled = true;
                        clearInterval(tradingInterval);
                    }
                } catch (error) {
                    addLog(`Error communicating with backend to start bot: ${error.message}`, "error");
                    botActive = false; // Keep frontend in sync
                    botStatus.textContent = "Backend connection error.";
                    botStatus.classList.remove('bot-active');
                    startBtn.disabled = false;
                    stopBtn.disabled = true;
                    clearInterval(tradingInterval);
                }

            } else {
                addLog("Please connect your wallet first.", "warning");
            }
        });

        stopBtn.addEventListener('click', async () => {
            botActive = false;
            startBtn.disabled = false;
            stopBtn.disabled = true;
            botStatus.textContent = "Bot offline";
            botStatus.classList.remove('bot-active');
            addLog("Trading bot stopped.");
            clearInterval(tradingInterval);

            // Notify backend that bot has stopped
            try {
                const response = await fetch('YOUR_BACKEND_URL/stop', { // <--- REPLACE 'YOUR_BACKEND_URL'
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                const result = await response.json();
                if (result.success) {
                    addLog("Backend acknowledged bot stop.", "success");
                } else {
                    addLog(`Backend failed to stop bot: ${result.error || 'Unknown error'}`, "error");
                }
            } catch (error) {
                addLog(`Error communicating with backend to stop bot: ${error.message}`, "error");
            }
        });

        testJupiterBtn.addEventListener('click', testJupiterAPI);

        refreshTokensBtn.addEventListener('click', () => {
            addLog("Refreshing token prices (simulation only).", "info");
            // In a real app, this would trigger an actual price fetch
            updateJupiterStatus("Token prices refreshed (simulated)");
        });

        // --- Auto-Connect Logic ---
        document.addEventListener('DOMContentLoaded', async () => {
            initializeTokenGrid();

            // Check if Phantom is already installed and connected
            if (window.phantom && window.phantom.solana && window.phantom.solana.isPhantom) {
                addLog("Phantom wallet detected. Attempting auto-connect...");
                try {
                    // Try to reconnect silently if already authorized
                    const isConnected = window.phantom.solana.isConnected;
                    if (isConnected) {
                        // If already connected, provider.publicKey will be available
                        provider = window.phantom.solana;
                        connectBtn.textContent = 'Connected';
                        connectBtn.classList.add('connected');
                        connectBtn.disabled = true; // Disable connect button if already connected
                        await checkBalance();
                        addLog(`Auto-connected to wallet: ${provider.publicKey.toString()}`, "success");
                        // Listen for account changes
                        provider.on('accountChanged', (publicKey) => {
                            if (publicKey) {
                                addLog(`Wallet account changed to: ${publicKey.toString().substring(0, 8)}...`, "info");
                                checkBalance();
                            } else {
                                addLog("Wallet disconnected.", "warning");
                                updateWalletStatus("Wallet disconnected.");
                                connectBtn.textContent = 'Connect Phantom';
                                connectBtn.classList.remove('connected');
                                connectBtn.disabled = false;
                                disableTradingButtons();
                            }
                        });
                    } else {
                        // If Phantom is available but not connected, display connect button
                        updateWalletStatus("Phantom wallet detected. Click 'Connect Phantom'.");
                        connectBtn.disabled = false; // Ensure button is enabled for manual connect
                    }
                } catch (err) {
                    console.error("Auto-connect failed:", err);
                    addLog("Auto-connect to Phantom failed. Please connect manually.", "error");
                    updateWalletStatus("Auto-connect failed. Click 'Connect Phantom'.");
                    connectBtn.disabled = false;
                }
            } else {
                addLog("Phantom wallet not detected in browser.", "warning");
                updateWalletStatus("Phantom wallet not installed. Please install to connect.");
                connectBtn.disabled = false; // Ensure button is enabled if Phantom not found (user can click for alert)
            }
        });
    </script>
</body>
</html>
